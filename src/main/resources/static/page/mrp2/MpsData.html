<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>DPS</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=317"/>
    <!--[if lt IE 9]>
    <script src="../../assets/libs/html5shiv/html5shiv.min.js"></script>
    <script src="../../assets/libs/respond/respond.min.js"></script>
    <![endif]-->

    <!-- 引入图标 -->
    <link rel="stylesheet" href="../../assets/iconfont/iconfont.css">

    <!-- 移取layui表格鼠标悬停事件 -->
    <style>
        .layui-table tbody tr:hover {
            background-color: transparent;
        }
    </style>
</head>
<body>
<!-- 页面加载loading -->
<div class="page-loading">
    <div class="ball-loader">
        <span></span><span></span><span></span><span></span>
    </div>
</div>
<!-- 正文开始 -->
<div class="theme-my layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">
            <!-- 数据表格 -->
            <table id="tableMps" lay-filter="tableMps"></table>
        </div>
    </div>
</div>
<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../assets/js/common.js?v=317"></script>
<script>
    layui.use(['admin', 'form', 'table', 'notice', 'laytpl', 'contextMenu', 'yutons_sug', 'laydate'], function() {
        var admin = layui.admin;
        var form = layui.form;
        var table = layui.table;
        var notice = layui.notice;
        var laytpl = layui.laytpl;
        var $ = layui.$;
        var contextMenu = layui.contextMenu;
        var yutons_sug = layui.yutons_sug;
        var laydate = layui.laydate;

        /* 获取URL请求的参数 */
        var getQueryVariable = function (variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] === variable){return pair[1];}
            }
            return(false);
        };
        var ver = getQueryVariable("ver");

        /**
         * 获取Dps版本的日历
         * @param ver dps版本
         */
        var getDpsCalendar = function(ver) {
            var URL_getCalendar = "/mrp/mps/getMpsCalendar";
            var calendar = {};
            $.ajax({
                type : "get",
                url: URL_getCalendar,
                data: {
                    ver: ver
                },
                async : false,
                success : function(data){
                    if(data.code === 200) {
                        calendar =  data.data;
                    } else {
                        notice.msg(data.msg, {icon: 2});
                    }
                },
                error: function(res) {
                    notice.msg("获取Mps版本的日历请求失败，" + res.status, {icon: 2});
                }
            });
            return calendar;
        };

        /**
         * 添加表格日期配置
         * @param days[] 日期数组
         * @param weeks[]  星期数组
         */
        var addColsDay = function(cols, days, months) {
            var col = cols[0];
            for(var i=0; i<days.length; i++) {
                (function(day, month) {
                    col.push({
                        field: day,
                        title: month,
                        align: 'center',
                        width: 120
                    });
                })(days[i], months[i]);
            }
        };

        //千分位
        var format = function(num) {
            var reg=/\d{1,3}(?=(\d{3})+$)/g;
            return (num + '').replace(reg, '$&,');
        };

        //渲染DPS数据表格
        var tableRender = function(ver) {
            var calendar = getDpsCalendar(ver);
            var cols = [[
                {type: 'numbers', align: 'center', fixed: 'left'},
                {field: 'product', title: '产品', align: 'center', width: 150, fixed: 'left'},
                {field: 'fab', title: '厂别', align: 'center', width: 80}
            ]];
            addColsDay(cols, calendar.days, calendar.months);
            table.render({
                elem: '#tableMps',
                method: 'get',
                url: '/mrp/mps/getDps',
                where: {
                    ver: ver
                },
                cols: cols,
                height: 'full-10',
                page: {layout:['count']},
                size: 'sm',
                even: true
            });
        };
        tableRender(ver);
    });
</script>
</body>
</html>