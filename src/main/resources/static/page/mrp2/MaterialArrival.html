<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>材料到货计划</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=317"/>
    <!--[if lt IE 9]>
    <script src="../../assets/libs/html5shiv/html5shiv.min.js"></script>
    <script src="../../assets/libs/respond/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-table-view .layui-table .layui-table-cell {
            height: auto;
        }
    </style>
</head>
<body>
<!-- 加载动画 -->
<div class="page-loading">
    <div class="ball-loader">
        <span></span><span></span><span></span><span></span>
    </div>
</div>

<!-- 正文开始 -->
<div class="layui-card" style="padding: 0px 10px;">
    <div class="layui-card-body">
        <!-- 表格 -->
        <table id="tableArrivalPlan" lay-filter="tableArrivalPlan"></table>
        <!-- 按钮 -->
        <div class="text-center" style="padding-top: 15px;padding-bottom: 15px;">
<!--            <button type="button" class="layui-btn layui-btn-sm" id="addBtn" lay-submit>添加</button>-->
            <button type="button" class="layui-btn layui-btn-sm" id="saveBtn" lay-submit>保存</button>
            <button type="button" class="layui-btn layui-btn-sm" id="closeBtn" ew-event="closeDialog">关闭</button>
        </div>
    </div>
</div>

<!-- 弹框 -->
<script type="text/html" id="addDialog">
    <div class="layui-card">
        <div class="layui-card-body">
            <form class="layui-form" id="addFrom" lay-filter="addFrom">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">厂商</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" id="supplier_" name="supplier" autocomplete="off" value="">
                            <input class="layui-input" id="supplierName_" name="supplierName" autocomplete="off" value="" style="display: none">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">到货量</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" id="arrivalQty_" name="arrivalQty" autocomplete="off" value="">
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</script>

<!-- js部分 -->
<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../assets/js/common.js?v=317"></script>
<script>
    layui.use(['layer', 'steps', 'form', 'table', "notice", "dropdown", 'admin'], function () {
        var table = layui.table;
        var form = layui.form;
        var $ = layui.$;
        var notice = layui.notice;
        var admin = layui.admin;

        var plant = admin.getLayerData().plant;
        var material = admin.getLayerData().material;
        var fabDate = admin.getLayerData().fabDate;

        $.get('/mrp/supplierArrivalPlan/getMaterialArrivalPlan', {
            plant: plant,
            material: material,
            fabDate: fabDate
        }, function(res) {
            table.render({
                elem: '#tableArrivalPlan',
                data: res.data,
                cols: [[
                    {type: 'numbers', align: 'center'},
                    {field: 'supplier', title: '供应商ID', align: 'center', minWidth: 100},
                    {field: 'supplierName', title: '供应商', align: 'center', minWidth: 100},
                    {field: 'arrivalQty', title: '到货量', align: 'center', edit: 'text'}
                ]],
                page: {layout: ['count']},
                size: 'sm'
            });
        });

        // //添加
        // $("#addBtn").click(function() {
        //     showAddDialog();
        // });

        // //修改
        // table.on('tool(tableArrivalPlan)', function(obj){
        //     if(obj.event === 'edit') {
        //         var data = {
        //             supplier: obj.data.supplier,
        //             supplierName: obj.data.supplierName,
        //             arrivalQty: obj.data.arrivalQty
        //         };
        //         showAddDialog(data);
        //     }
        // });

        // //添加、修改弹框
        // var showAddDialog = function(data) {
        //     var title = data ? "修改到货量" : "添加到货量";
        //     admin.open({
        //         type: 1,
        //         title: title,
        //         content: $('#addDialog').html(),
        //         btn: ['确定', '取消'],
        //         area: ['700px', '200px'],
        //         success: function (layero, dIndex) {
        //             form.val("addFrom", data);
        //             if(data) {
        //                 $('#supplier_').attr("readonly","readonly");
        //             }
        //         },
        //         yes: function(index, layero) {
        //             var f = form.val("addFrom");
        //             var data = layui.table.cache['tableArrivalPlan'];
        //             var edit = false;
        //             for(var i=0; i<data.length; i++) {
        //                 if( data[i].supplier === f.supplier ) {
        //                     data[i].arrivalQty = f.arrivalQty;
        //                     edit = true;
        //                     break;
        //                 }
        //             }
        //             if(!edit) {
        //                 data.push({
        //                     plant: plant,
        //                     material: material,
        //                     date: fabDate,
        //                     supplier: f.supplier,
        //                     supplierName: f.supplierName,
        //                     arrivalQty: f.arrivalQty
        //                 });
        //             }
        //             table.reload('tableArrivalPlan', {data: data});
        //             layer.close(index);
        //         }
        //     });
        // };

        //保存提交
        $("#saveBtn").click(function() {
            var data = layui.table.cache['tableArrivalPlan'];
            console.log(data);
            $.post('/mrp/supplierArrivalPlan/bachSubmitArrival', {
                plant: plant,
                material: material,
                fabDate: fabDate,
                jsons: JSON.stringify(data)
            }, function(res) {
                if(res.code === 200) {
                    admin.putLayerData('editOk', true);
                    admin.closeThisDialog();
                } else {
                    notice.msg(res.msg, {icon: 2});
                }
            });
        });

    });
</script>
</body>
</html>