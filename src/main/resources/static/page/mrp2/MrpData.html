<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>MRP版本信息</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=317"/>
    <!--[if lt IE 9]>
    <script src="../../assets/libs/html5shiv/html5shiv.min.js"></script>
    <script src="../../assets/libs/respond/respond.min.js"></script>
    <![endif]-->
</head>
<body>

<table class="layui-table" id="test" lay-filter="test"></table>

<script type="text/html" id="trDemo">
    <tr data-index="{{d.index}}">
        <td data-field="num" data-key="1-0-0" align="center">
            <div class="layui-table-cell laytable-cell-1-0-0">{{d.num}}</div>
        </td>
        <td data-field="products" data-key="1-0-1" align="center">
            <div class="layui-table-cell laytable-cell-1-0-1">LCM1</div>
        </td>
        <td data-field="material" data-key="1-0-2" align="center">
            <div class="layui-table-cell laytable-cell-1-0-2">T050SWAF-211E10</div>
        </td>
        <td data-field="plant" data-key="1-0-3" align="center">
            <div class="layui-table-cell laytable-cell-1-0-3">913</div>
        </td>
        <td data-field="materialGroup" data-key="1-0-4" align="center">
            <div class="layui-table-cell laytable-cell-1-0-4">02-5-041-0000002</div>
        </td>
        <td data-field="materilaName" data-key="1-0-5" align="center">
            <div class="layui-table-cell laytable-cell-1-0-5">S050F R2 联创 BPV5047AHD-BL-A</div>
        </td>
        <td data-field="suppliers" data-key="1-0-6" align="center">
            <div class="layui-table-cell laytable-cell-1-0-6">PCS</div>
        </td>
        <td data-field="lossRate" data-key="1-0-7" align="center">
            <div class="layui-table-cell laytable-cell-1-0-7">pppppp</div>
        </td>
    </tr>
</script>

<!-- js部分 -->
<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../assets/js/common.js?v=317"></script>
<script>
    layui.use(['layer', 'steps', 'form', 'table', 'notice', 'admin', 'laytpl', 'laydate', 'flow'], function () {
        var table = layui.table;
        var $ = layui.$;
        var notice = layui.notice;
        var admin = layui.admin;
        var form = layui.form;
        var laytpl = layui.laytpl;
        var laydate = layui.laydate;
        var flow = layui.flow;

        /* 获取URL请求的参数 */
        var getQueryVariable = function (variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] === variable){return pair[1];}
            }
            return(false);
        };
        var mrpVer = getQueryVariable("mrpVer");


        //执行渲染
        var tabelData = [{}];
        var t = table.render({
            elem: '#test',
            data: tabelData,
            height: 715,
            cols: [[
                {field: 'num', title: '', align: 'center', width: 100, sort: true},
                {field: 'products', title: '机种', align: 'center', width: 100},
                {field: 'material', title: '料号', align: 'center', width: 100},
                {field: 'plant', title: '厂别', align: 'center', width: 100},
                {field: 'materialGroup', title: '物料组', align: 'center', width: 100},
                {field: 'materilaName', title: '品名', align: 'center', width: 100},
                {field: 'suppliers', title: '供应商', align: 'center', width: 100},
                {field: 'lossRate', title: '损耗率', align: 'center', width: 100},
            ]],
            done: function() {
                $("div[lay-id='test'] div.layui-table-main table tbody").empty()
                $("div[lay-id='test'] div.layui-table-main table tbody").attr('id','idddd');
                var number = 0;
                flow.load({
                    elem: '#idddd' //指定列表容器
                    ,done: function(page, next){ //到达临界点（默认滚动触发），触发下一页
                        var lis = [];
                        //以jQuery的Ajax请求为例，请求下一页数据（注意：page是从2开始返回）
                        var limit = 1000;
                        $.ajax({
                            type: 'get',
                            url: '/mrp/getMrpData',
                            data: {
                                mrpVer: mrpVer,
                                material: '',
                                product: '',
                                page: page,
                                limit: limit
                            },
                            success: function(res){
                                //假设你的列表返回在data集合中
                                layui.each(res.data, function(index, item){
                                    var d = res.data;
                                    d.index = number++;
                                    d.num = number;
                                    // lis.push(renderTr(d));
                                    t.addData(d);
                                });
                                //执行下一页渲染，第二参数为：满足“加载更多”的条件，即后面仍有分页
                                //pages为Ajax返回的总页数，只有当前页小于总页数的情况下，才会继续出现加载更多
                                next('', page < res.count/limit);
                            }
                        });
                    }
                });
            }
        });

        var renderTr = function(d) {
            return laytpl(trDemo.innerHTML).render(d);
        }
    });
</script>
</body>
</html>